/*! Built with http://stenciljs.com */
const{h:t}=window.components;import{a as i}from"./chunk-4e6b1b49.js";import{a as e}from"./chunk-a93dedfa.js";import{a as n,b as o,d as a}from"./chunk-f91cccde.js";var r,s,l;!function(t){t.WidgetProperties="WidgetProperties",t.SectionProperties="SectionProperties",t.TemplateProperties="TemplateProperties",t.Custom="Custom"}(r||(r={})),function(t){t.Center="center",t.Left="left",t.Right="right"}(s||(s={})),function(t){t.AddWidget="addWidget",t.AddSection="addSection",t.ChangeSection="changeSection",t.Personalization="personalization"}(l||(l={}));const p=(t,e=i/2)=>{const n=d(t),o=c(e);return n.left<o?s.Right:n.right<o?s.Left:s.Center},c=t=>{const i=document.body.querySelector("kentico-pop-up-container");return i&&i.offsetWidth?i.offsetWidth/2:t},d=t=>({left:t.left,right:window.innerWidth-t.right});var h;!function(t){t[t.ConditionTypeListing=0]="ConditionTypeListing",t[t.VariantListing=1]="VariantListing",t[t.VariantConfiguration=2]="VariantConfiguration"}(h||(h={}));class u{constructor(){this.dialogMode=h.ConditionTypeListing,this.reset=(t=>{this.hasConditionType?this.dialogMode=h.VariantListing:(this.dialogMode=h.ConditionTypeListing,this.selectedConditionType=null),this.selectedVariantIdentifier=null,this.variantParameters=null,this.variantName=null,t&&this.updatePositionDelayed()}),this.selectConditionTypeHandler=(t=>{t.stopPropagation(),this.selectedConditionType=t.detail.key,this.dialogMode=h.VariantConfiguration,this.updatePositionDelayed()}),this.updatePosition=(()=>this.personalizationPopupPosition=p(this.thisElement.getBoundingClientRect())),this.updatePositionDelayed=(()=>{window.requestAnimationFrame(this.updatePosition)}),this.closePersonalizationPopupHandler=(t=>{t.stopPropagation(),this.closePersonalizationPopup.emit()}),this.onAddVariantButtonClick=(t=>{t.stopPropagation(),this.dialogMode=h.VariantConfiguration,this.updatePositionDelayed()}),this.onEditVariantButtonClick=(t=>{this.selectedVariantIdentifier=t.key,this.variantParameters=t.parameters,this.variantName=t.name,this.dialogMode=h.VariantConfiguration,this.updatePositionDelayed()}),this.render=(()=>t("div",{class:"ktc-widget-header-personalization-wrapper"},t("div",{class:"ktc-widget-header-personalization"},t("a",{class:"ktc-widget-header-icon",title:this.personalizationTooltip,onClick:()=>this.openPersonalizationPopup.emit()},this.hasConditionType?t("i",{"aria-hidden":"true",class:"icon-personalisation-variants"}):t("i",{"aria-hidden":"true",class:"icon-personalisation"})),this.showPersonalizationPopup&&t("kentico-pop-up-container",{localizationService:this.localizationService,headerTitle:this.headerText,theme:e.Widget,showBackButton:this.dialogMode===h.VariantConfiguration,position:this.personalizationPopupPosition,onClick:t=>t.stopPropagation(),onClosePopup:this.closePersonalizationPopupHandler,onBackClick:this.reset.bind(this,!0)},t("div",{slot:"pop-up-content"},this.renderPopupContent()),this.dialogMode===h.VariantListing?t("div",{slot:"pop-up-footer",class:"ktc-popup-footer"},t("kentico-submit-button",{onButtonClick:this.onAddVariantButtonClick,buttonText:this.getString(this.localizationService,"variant.add"),buttonTooltip:this.getString(this.localizationService,"variant.addTooltip")})):null)))),this.renderPopupContent=(()=>{switch(this.dialogMode){case h.VariantListing:return t("div",null,t("div",{class:"ktc-pop-up-content-header"},this.variantListingContentHeaderText),t("kentico-variant-listing",{activeItemIdentifier:this.activeItemIdentifier,variants:this.popupItems,localizationService:this.localizationService,deleteVariant:this.deleteVariant,editVariant:this.onEditVariantButtonClick,selectVariant:this.selectVariant,changeVariantsPriority:this.changeVariantsPriority}));case h.ConditionTypeListing:return t("div",null,t("div",{class:"ktc-pop-up-content-header"},this.conditionTypeListingContentHeaderText),t("kentico-pop-up-listing",{activeItemIdentifier:this.activeItemIdentifier,items:this.popupItems,onSelectItem:this.selectConditionTypeHandler,singleColumn:!0}));case h.VariantConfiguration:const i=this.getString(this.localizationService,this.personalizationConditionTypes[this.currentConditionType].hint);return t("div",null,i&&t("div",{class:"ktc-pop-up-content-header"},i),t("kentico-personalization-configuration",{builderConfig:this.builderConfig,httpClient:this.httpClient,localizationService:this.localizationService,personalizationConditionTypes:this.personalizationConditionTypes,selectedConditionType:this.currentConditionType,variantIdentifier:this.selectedVariantIdentifier,variantName:this.variantName,variantParameters:this.variantParameters,configurationLoaded:this.updatePositionDelayed,addVariant:this.addVariant,updateVariant:this.updateVariant}))}})}get personalizationTooltip(){return this.getString(this.localizationService,"widget.personalizeTooltip")}get currentConditionType(){return this.selectedConditionType?this.selectedConditionType:this.conditionType}get hasConditionType(){return!!this.conditionType}get headerText(){switch(this.dialogMode){case h.ConditionTypeListing:return this.getString(this.localizationService,"widget.conditiontypepopup.header");case h.VariantListing:return this.personalizationConditionTypes[this.currentConditionType].name;case h.VariantConfiguration:return this.getString(this.localizationService,this.selectedVariantIdentifier?"variant.edit":"variant.add")}}get conditionTypeListingContentHeaderText(){return this.getString(this.localizationService,"widget.conditiontypepopup.conditiontypeheader")}get variantListingContentHeaderText(){return this.getString(this.localizationService,"widget.conditiontypepopup.variantheader")}showPersonalizationPopupChanged(){this.reset(!1)}static get is(){return"kentico-personalization-button"}static get properties(){return{activeItemIdentifier:{type:String,attr:"active-item-identifier"},addVariant:{type:"Any",attr:"add-variant"},builderConfig:{type:"Any",attr:"builder-config"},changeVariantsPriority:{type:"Any",attr:"change-variants-priority"},conditionType:{type:String,attr:"condition-type"},deleteVariant:{type:"Any",attr:"delete-variant"},dialogMode:{state:!0},getString:{context:"getString"},httpClient:{type:"Any",attr:"http-client"},localizationService:{type:"Any",attr:"localization-service"},personalizationConditionTypes:{type:"Any",attr:"personalization-condition-types"},personalizationPopupPosition:{type:"Any",attr:"personalization-popup-position",mutable:!0},popupItems:{type:"Any",attr:"popup-items"},selectedConditionType:{state:!0},selectedVariantIdentifier:{state:!0},selectVariant:{type:"Any",attr:"select-variant"},showPersonalizationPopup:{type:Boolean,attr:"show-personalization-popup",watchCallbacks:["showPersonalizationPopupChanged"]},thisElement:{elementRef:!0},updateVariant:{type:"Any",attr:"update-variant"},variantName:{state:!0},variantParameters:{state:!0}}}static get events(){return[{name:"openPersonalizationPopup",method:"openPersonalizationPopup",bubbles:!0,cancelable:!0,composed:!0},{name:"closePersonalizationPopup",method:"closePersonalizationPopup",bubbles:!0,cancelable:!0,composed:!0}]}static get style(){return"[class*=\" icon-\"],[class^=icon-]{font-family:Core-icons;display:inline-block;speak:none;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;font-size:16px;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;background-image:none}[class^=icon-]:before{content:\"\\e619\"}.ktc-icon-only:before{content:none}kentico-personalization-button .ktc-widget-header-personalization-wrapper{position:relative}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization{display:inline-block}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization .ktc-widget-header-icon i{cursor:pointer;color:#fff;padding:8px 4px}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container{position:absolute;border-color:transparent transparent #0f6194;top:41px;left:50%;z-index:-1}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container:before{content:'';display:block;position:absolute;left:50%;margin-left:-10px;width:0;height:0;top:-20px;pointer-events:none;border:10px solid;border-color:inherit}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container[position=center]{-webkit-transform:translateX(-50%);transform:translateX(-50%)}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container[position=left]{-webkit-transform:translateX(-100%) translateX(18px);transform:translateX(-100%) translateX(18px)}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container[position=left]:before{left:calc(100% - 18px)}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container[position=right]{-webkit-transform:translateX(-18px);transform:translateX(-18px)}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization kentico-pop-up-container[position=right]:before{left:18px}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization .icon-personalisation:before{content:\"\\e900\"}kentico-personalization-button .ktc-widget-header-personalization-wrapper .ktc-widget-header-personalization .icon-personalisation-variants:before{content:\"\\e901\"}"}}const g={insertItemIntoArray:(t,i,e)=>e>t.length||e<0?t:[...t.slice(0,e),i,...t.slice(e)],replaceItem:(t,i,e)=>!t.length||e>t.length||e<0?t:[...t.slice(0,e),i,...t.slice(e+1)],removeItem:(t,i)=>i>t.length||i<0?t:[...t.slice(0,i),...t.slice(i+1)],moveItemBetweenArrays:(t,i,e,n=null)=>{const o=null===n?t.length-1:n.length;if(e<0||e>o)throw new RangeError("The [position] argument is invalid.");if(!g.contains(t,i))throw new Error("The [item] was not found in [sourceArray].");const a=t.filter(t=>t!==i);return null===n?{sourceArray:g.insertItemIntoArray(a,i,e),destinationArray:null}:{sourceArray:a,destinationArray:g.insertItemIntoArray(n,i,e)}},getUniqueValues:(t,i=(t=>t))=>[...new Set(t.map(i))],contains:(t,i)=>t.indexOf(i)>=0,move:(t,i,e)=>(t.splice(e,0,t.splice(i,1)[0]),t)};var y=function(t,i){var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&i.indexOf(n)<0&&(e[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(t);o<n.length;o++)i.indexOf(n[o])<0&&(e[n[o]]=t[n[o]])}return e};class m{constructor(){this.variantNamePropertyName="variantName",this.externalScriptIdentifier="ktc-personalization-configuration-script",this.logError=(t=>{const i=new Error(this.getString(this.localizationService,t));a.logExceptionWithMessage(i,this.getString(this.localizationService,"errors.generalerror"))}),this.getConditionMarkup=(async()=>{try{const t=this.personalizationConditionTypes[this.selectedConditionType].markupUrl,i=this.variantParameters||{},e=this.builderConfig.getComponentMarkupData(Object.assign({},i,{[this.variantNamePropertyName]:this.variantName})),n=await this.httpClient.post(t,e);this.configurationMarkup=this.ensureStyles(n.data,this.hostElement.nodeName)}catch(t){const i=this.getString(this.localizationService,"errors.generalerror");this.configurationMarkup=`<div class="ktc-variant-configuration-error">${i}</div>`,a.logExceptionWithMessage(t,i)}}),this.renderNewMarkup=(()=>{o(this.configurationMarkup,this.configurationElement,this.externalScriptIdentifier),this.configurationForm=this.configurationElement.getElementsByTagName("form")[0],this.configurationForm?(this.configurationForm.addEventListener("submit",this.onSubmit),this.configurationLoaded&&this.configurationLoaded()):this.logError("conditiontype.missingConfigForm")}),this.onSubmit=(async t=>{let i;if(t.preventDefault(),!this.configurationForm)return void this.logError("conditiontype.missingConfigForm");try{i=await this.httpClient.post(this.configurationForm.action,new FormData(this.configurationForm))}catch(t){return void a.logExceptionWithMessage(t,this.getString(this.localizationService,"errors.generalerror"))}if(g.contains(i.headers["content-type"],"text/html"))return this.configurationMarkup=this.ensureStyles(i.data,this.hostElement.nodeName),n(this.externalScriptIdentifier),void this.renderNewMarkup();if(!g.contains(i.headers["content-type"],"application/json"))return void this.logError("conditiontype.wrongFormPostResponse");const e=i.data,o=this.variantNamePropertyName,r=e[o],s=y(e,["symbol"==typeof o?o:o+""]);if(r){const t=r.trim();this.variantIdentifier?this.updateVariant(t,s,this.variantIdentifier):this.addVariant(t,this.selectedConditionType,s)}else this.logError("conditiontype.missingVariantName")}),this.render=(()=>t("div",{class:"ktc-variant-configuration ktc-form-wrapper"},t("div",{ref:t=>this.configurationElement=t,class:"ktc-form"}),t("div",{class:"ktc-configuration-footer"},t("kentico-submit-button",{onButtonClick:this.onSubmit,buttonText:this.buttonText,buttonTooltip:this.buttonTooltip}))))}get buttonText(){const t=this.variantIdentifier?"variant.apply":"variant.add";return this.getString(this.localizationService,t)}get buttonTooltip(){const t=this.variantIdentifier?"variant.applyTooltip":"variant.addTooltip";return this.getString(this.localizationService,t)}componentWillLoad(){return this.getConditionMarkup()}componentDidLoad(){this.renderNewMarkup()}componentDidUnload(){n(this.externalScriptIdentifier)}static get is(){return"kentico-personalization-configuration"}static get properties(){return{addVariant:{type:"Any",attr:"add-variant"},builderConfig:{type:"Any",attr:"builder-config"},configurationLoaded:{type:"Any",attr:"configuration-loaded"},ensureStyles:{context:"ensureStyles"},getString:{context:"getString"},hostElement:{elementRef:!0},httpClient:{type:"Any",attr:"http-client"},localizationService:{type:"Any",attr:"localization-service"},personalizationConditionTypes:{type:"Any",attr:"personalization-condition-types"},selectedConditionType:{type:String,attr:"selected-condition-type"},updateVariant:{type:"Any",attr:"update-variant"},variantIdentifier:{type:String,attr:"variant-identifier"},variantName:{type:String,attr:"variant-name"},variantParameters:{type:"Any",attr:"variant-parameters"}}}static get style(){return"kentico-personalization-configuration .ktc-checkbox input:disabled+input[type=hidden]+label:before{content:\"\\e6f0\"}kentico-personalization-configuration .ktc-checkbox input:checked+input[type=hidden]+label::after{content:\"\\e6b0\"}kentico-personalization-configuration .ktc-variant-configuration{padding-top:8px}kentico-personalization-configuration .ktc-variant-configuration .ktc-variant-configuration-error{color:#d12127}kentico-personalization-configuration .ktc-variant-configuration .ktc-configuration-footer{background-color:#fff;min-height:57.6px}kentico-personalization-configuration .ktc-variant-configuration .ktc-configuration-footer::before{content:'';border-bottom:1px solid #d6d9d6;width:100%;display:block;padding-top:8px}kentico-personalization-configuration .ktc-variant-configuration .ktc-configuration-footer kentico-submit-button{float:right;margin-top:8px}"}}export{u as KenticoPersonalizationButton,m as KenticoPersonalizationConfiguration};